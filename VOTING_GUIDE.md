# 메뉴 투표 시스템 사용 가이드

## 📋 목차
- [개요](#개요)
- [기본 사용법](#기본-사용법)
- [주요 기능](#주요-기능)
- [투표 옵션](#투표-옵션)
- [권한 및 제한](#권한-및-제한)
- [투표 결과](#투표-결과)
- [명령어 요약](#명령어-요약)
- [팁](#팁)

## 개요

메뉴 투표 시스템은 Discord 서버에서 그룹이 함께 메뉴를 결정할 수 있도록 돕는 봇 기능입니다. 메뉴 제안부터 투표, 결과 확인까지 전체 과정을 관리합니다.

**핵심 특징:**
- 0~5점 점수 시스템
- 0점을 받은 메뉴는 자동으로 제외
- 동점 시 최소점으로 순위 결정
- 1위가 여러 개일 때 랜덤 선택 기능
- 제한된 투표 모드 지원

## 기본 사용법

### 1. 투표 시작하기

```
/투표시작 제목:<투표 제목> [투표제한:True/False]
```

**예시:**
- `/투표시작 제목:점심 메뉴 투표` - 일반 투표 (모두 참여 가능)
- `/투표시작 제목:저녁 메뉴 투표 투표제한:True` - 제한된 투표 (허용된 사람만 참여)

투표가 시작되면 메뉴 제안 단계가 시작됩니다.

### 2. 메뉴 제안하기

```
/메뉴제안 메뉴:<메뉴명>
```

**예시:**
- `/메뉴제안 메뉴:김치찌개`
- `/메뉴제안 메뉴:된장찌개`

**제약사항:**
- 투표가 시작되기 전에만 메뉴를 제안할 수 있습니다
- 중복된 메뉴는 제안할 수 없습니다
- 최소 2개 이상의 메뉴가 있어야 투표를 시작할 수 있습니다

### 3. 메뉴 제안 취소하기

```
/메뉴제안취소 메뉴:<메뉴명>
```

**권한:**
- 본인이 제안한 메뉴는 누구나 취소 가능
- 투표 생성자는 모든 메뉴 취소 가능
- 관리자는 모든 메뉴 취소 가능

명령어 입력 시 자동완성으로 취소 가능한 메뉴 목록이 표시됩니다.

### 4. 제안 마감 및 투표 시작

투표 메시지에서 **"제안 마감 및 투표 시작"** 버튼을 클릭합니다.

**조건:**
- 투표 생성자만 가능
- 최소 2개 이상의 메뉴 필요

기존 메시지는 "제안 마감됨"으로 변경되고, 새로운 투표 메시지가 전송됩니다.

### 5. 투표하기

**"투표하기"** 버튼을 클릭하면:

#### 첫 투표 (순차 모드)
처음 투표하는 경우, 메뉴가 하나씩 순서대로 표시됩니다:

1. 첫 번째 메뉴가 표시됩니다
2. 0~5점 중 선택합니다
3. 자동으로 다음 메뉴로 넘어갑니다
4. 모든 메뉴에 점수를 매기면 자동으로 완료됩니다

#### 투표 수정 (선택 모드)
이미 투표한 경우:

1. 기존 투표 내역이 표시됩니다
2. 수정할 메뉴를 선택합니다
3. 새로운 점수를 선택합니다
4. 원하는 만큼 수정한 후 "투표 수정 완료" 버튼 클릭

**참고:** 수정 모드에서는 일부 메뉴만 변경해도 됩니다.

### 6. 투표 종료

투표 메시지에서 **"투표 종료 및 결과 보기"** 버튼을 클릭합니다.

**조건:**
- 투표 생성자만 가능
- 최소 1명 이상 투표 참여 필요

기존 메시지는 "투표 종료됨"으로 변경되고, 새로운 결과 메시지가 전송됩니다.

## 주요 기능

### 🔒 제한된 투표

투표 시작 시 `투표제한:True` 옵션을 사용하면:
- 투표 생성자가 허용한 사람만 투표할 수 있습니다
- 투표 생성자는 항상 투표할 수 있습니다
- 제목 옆에 🔒 아이콘이 표시됩니다

#### 투표 참여 허용하기

```
/투표허용 사용자:@유저
```

**예시:**
- `/투표허용 사용자:@홍길동`

허용되지 않은 사용자가 투표를 시도하면 오류 메시지가 표시됩니다.

### 📊 점수 시스템

각 메뉴에 0~5점을 부여할 수 있습니다:

| 점수 | 이모지 | 의미 |
|------|--------|------|
| 0점 | 0️⃣ | 절대 안됨 |
| 1점 | 1️⃣ | 매우 별로 |
| 2점 | 2️⃣ | 별로 |
| 3점 | 3️⃣ | 보통 |
| 4점 | 4️⃣ | 좋음 |
| 5점 | 5️⃣ | 매우 좋음 |

#### 0점의 특별한 의미

**0점을 받은 메뉴는:**
- 순위에서 완전히 제외됩니다
- 결과 화면 하단에 별도로 표시됩니다
- 누가 0점을 주었는지 공개됩니다

**예시:**
```
❌ 제외된 메뉴 (0점 포함)
**짬뽕** (총점: 8점) - 0점을 준 사람: 홍길동
**볶음밥** (총점: 12점) - 0점을 준 사람: 김철수, 이영희
```

### 🏆 순위 결정 방식

**1차 기준: 총점** (높을수록 순위 ↑)
- 모든 투표자가 준 점수의 합계

**2차 기준: 최소점** (동점일 때, 높을수록 순위 ↑)
- 받은 점수 중 가장 낮은 점수
- "모두가 어느 정도 만족하는 선택"을 우선

**예시:**
```
메뉴A: 5점, 4점, 4점 → 총점 13점, 최소점 4점
메뉴B: 5점, 5점, 3점 → 총점 13점, 최소점 3점
```
→ 총점은 같지만 **메뉴A**가 1위 (최소점이 더 높음)

#### 동점 처리

총점과 최소점이 **모두 같으면** 같은 순위로 표시됩니다:

```
🥇 1위. 김치찌개 - 15점 (최소: 3점)
🥇 1위. 된장찌개 - 15점 (최소: 3점)
   3위. 부대찌개 - 14점 (최소: 4점)
```

### 🎲 랜덤 선택

투표 결과에서 1위가 여러 개인 경우:

1. **"🎲 1위 메뉴 중 랜덤 선택"** 버튼이 자동으로 표시됩니다
2. 버튼을 클릭하면 1위 메뉴 중 하나를 무작위로 선택합니다
3. 선택 결과는 새 메시지로 표시됩니다:
   ```
   🎲 랜덤 선택 결과

   🎯 김치찌개

   후보 메뉴: 김치찌개, 된장찌개
   ```
4. 버튼은 한 번 사용하면 비활성화됩니다 (✅ 랜덤 선택 완료)

**참고:** 1위가 하나뿐이면 버튼이 표시되지 않습니다.

### 👥 투표 현황

투표 진행 중 실시간으로 확인할 수 있는 정보:
- 투표 완료한 사람 수
- 투표자 이름 목록

```
투표 현황
3명 투표 완료
홍길동, 김철수, 이영희
```

## 권한 및 제한

### 투표 생성자 권한

투표를 시작한 사람(`/투표시작` 실행자)은:
- ✅ 제안 마감 및 투표 시작
- ✅ 투표 종료 및 결과 보기
- ✅ 투표 취소
- ✅ 모든 메뉴 제안 삭제 가능
- ✅ 제한된 투표에서 참여자 허용 (`/투표허용`)
- ✅ 메뉴 제안 시 모든 메뉴 목록 확인 가능

### 관리자 권한

관리자(permissions.py에 등록된 사용자)는 추가로:
- ✅ 모든 메뉴 제안 삭제 가능
- ✅ 메뉴 제안 시 모든 메뉴 목록 확인 가능

**관리자 등록:**
`menu_voting/permissions.py` 파일의 `ADMIN_USERS` 집합에 사용자명 추가

### 일반 사용자 권한

모든 사용자는:
- ✅ 투표 시작 가능
- ✅ 메뉴 제안 가능
- ✅ 본인이 제안한 메뉴 취소 가능
- ✅ 투표 참여 가능 (제한 모드가 아닌 경우)

### 제한 사항

- 한 서버에서 동시에 하나의 투표만 진행 가능
- 메뉴는 최대 25개까지 표시 (Discord Select 제약)
- 투표 시작 후에는 메뉴 추가/삭제 불가

## 투표 결과

### 결과 화면 구성

#### 1. 🎯 최종 선택
1위 메뉴를 강조하여 표시합니다.

**단독 1위:**
```
🎯 최종 선택

🥇 김치찌개
총점: 18점 (최소점: 4점)
```

**공동 1위:**
```
🎯 최종 선택

🥇 김치찌개, 된장찌개
총점: 15점 (최소점: 3점)
(동점)
```

#### 2. 📊 전체 순위
모든 메뉴의 순위, 총점, 최소점을 표시합니다.

```
📊 전체 순위

🥇 1위. 김치찌개 - 18점 (최소: 4점)
🥈 2위. 된장찌개 - 16점 (최소: 3점)
🥉 3위. 부대찌개 - 14점 (최소: 3점)
   4위. 순두부찌개 - 12점 (최소: 2점)
```

**참고:** 0점을 받은 메뉴는 여기에 표시되지 않습니다.

#### 3. 📈 상위 메뉴 점수 분포
상위 3개 메뉴의 개별 점수를 표시합니다.

```
📈 상위 메뉴 점수 분포

김치찌개: 5, 5, 4, 4
된장찌개: 5, 5, 3, 3
부대찌개: 5, 4, 3, 2
```

#### 4. ❌ 제외된 메뉴 (0점 포함)
0점을 받은 메뉴를 별도로 표시합니다.

```
❌ 제외된 메뉴 (0점 포함)

짬뽕 (총점: 8점) - 0점을 준 사람: 홍길동
볶음밥 (총점: 12점) - 0점을 준 사람: 김철수, 이영희
```

### 특수 상황

#### 모든 메뉴가 0점을 받은 경우

```
🎯 최종 선택

⚠️ 모든 메뉴가 0점을 포함하여 순위에서 제외되었습니다.

❌ 제외된 메뉴 (0점 포함)

김치찌개 (총점: 10점) - 0점을 준 사람: 홍길동
된장찌개 (총점: 8점) - 0점을 준 사람: 김철수
부대찌개 (총점: 6점) - 0점을 준 사람: 이영희
```

#### 투표 참여자가 없는 경우

투표 종료 버튼 클릭 시 오류 메시지가 표시되며, 최소 1명 이상 투표해야 종료할 수 있습니다.

## 명령어 요약

| 명령어 | 형식 | 설명 | 권한 |
|--------|------|------|------|
| `/투표시작` | `/투표시작 제목:<제목> [투표제한:True/False]` | 새 투표 세션 시작 | 모든 사용자 |
| `/메뉴제안` | `/메뉴제안 메뉴:<메뉴명>` | 메뉴 제안 추가 | 모든 사용자 |
| `/메뉴제안취소` | `/메뉴제안취소 메뉴:<메뉴명>` | 메뉴 제안 삭제 | 제안자/생성자/관리자 |
| `/투표허용` | `/투표허용 사용자:@유저` | 사용자 투표 허용 (제한 모드) | 투표 생성자 |

## 팁

### 효율적인 투표 진행

1. **충분한 제안 시간**
   - 메뉴 제안 단계에서 충분한 시간을 주세요
   - 최소 3-4개 이상의 메뉴를 제안하면 더 의미있는 결과를 얻을 수 있습니다

2. **메뉴 다양성**
   - 다양한 카테고리의 메뉴를 제안하면 더 흥미로운 투표가 됩니다
   - 예: 한식, 중식, 일식, 양식 등

### 0점 활용하기

1. **명확한 거부 의사**
   - 절대 먹고 싶지 않은 메뉴에만 0점을 사용하세요
   - 0점이 공개되므로 신중하게 사용하세요

2. **알레르기나 식이 제한**
   - 알레르기가 있거나 종교적/개인적 이유로 먹을 수 없는 메뉴에 0점 사용

3. **투명성**
   - 0점을 준 이유를 별도로 설명하면 그룹 내 이해도가 높아집니다

### 제한된 투표 활용

1. **소규모 그룹**
   - 특정 팀이나 부서의 투표에 적합합니다
   - 외부인의 참여를 방지할 수 있습니다

2. **사전 참여자 확정**
   - 투표 시작 전에 참여자를 미리 허용해두세요
   - `/투표허용` 명령어로 한 명씩 추가

### 투표 수정

1. **언제든 수정 가능**
   - 투표 종료 전까지는 자유롭게 수정할 수 있습니다
   - 다른 사람의 투표를 보고 싶지 않다면 투표 현황을 참고하지 마세요

2. **부분 수정**
   - 수정 모드에서는 일부 메뉴만 변경해도 됩니다
   - 모든 메뉴를 다시 투표할 필요가 없습니다

### 랜덤 선택 활용

1. **공정한 결정**
   - 동점일 때 결정을 내리기 어렵다면 랜덤 선택을 활용하세요
   - 공정하고 재미있는 방식으로 최종 결정을 내릴 수 있습니다

2. **그룹 합의**
   - 랜덤 선택 버튼을 누르기 전에 그룹 내 합의를 먼저 구하세요
   - 랜덤 선택 결과를 모두가 받아들이기로 약속하세요

## 예시 시나리오

### 시나리오: 5명의 팀 점심 메뉴 투표

1. **Alice가 투표 시작**
   ```
   /투표시작 제목:오늘 점심 메뉴
   ```

2. **메뉴 제안**
   - Alice: `/메뉴제안 메뉴:김치찌개`
   - Bob: `/메뉴제안 메뉴:된장찌개`
   - Charlie: `/메뉴제안 메뉴:부대찌개`
   - David: `/메뉴제안 메뉴:순두부찌개`
   - Eve: `/메뉴제안 메뉴:짬뽕`

3. **Alice가 제안 마감**
   - "제안 마감 및 투표 시작" 버튼 클릭
   - 기존 메시지가 "제안 마감됨"으로 변경
   - 새로운 투표 메시지 생성

4. **투표 진행**
   - Alice: 김치찌개 5점, 된장찌개 4점, 부대찌개 3점, 순두부찌개 4점, 짬뽕 0점
   - Bob: 김치찌개 5점, 된장찌개 5점, 부대찌개 3점, 순두부찌개 3점, 짬뽕 4점
   - Charlie: 김치찌개 4점, 된장찌개 3점, 부대찌개 5점, 순두부찌개 2점, 짬뽕 2점
   - David: 김치찌개 4점, 된장찌개 3점, 부대찌개 3점, 순두부찌개 3점, 짬뽕 2점
   - Eve: 김치찌개 5점, 된장찌개 4점, 부대찌개 4점, 순두부찌개 5점, 짬뽕 0점

   투표 현황:
   ```
   5명 투표 완료
   Alice, Bob, Charlie, David, Eve
   ```

5. **Alice가 투표 종료**
   - "투표 종료 및 결과 보기" 버튼 클릭
   - 기존 메시지가 "투표 종료됨"으로 변경
   - 새로운 결과 메시지 생성

6. **결과**
   ```
   🎯 최종 선택

   🥇 김치찌개
   총점: 23점 (최소점: 4점)

   📊 전체 순위

   🥇 1위. 김치찌개 - 23점 (최소: 4점)
   🥈 2위. 된장찌개 - 19점 (최소: 3점)
   🥉 3위. 부대찌개 - 18점 (최소: 3점)
      4위. 순두부찌개 - 17점 (최소: 2점)

   📈 상위 메뉴 점수 분포

   김치찌개: 5, 5, 5, 4, 4
   된장찌개: 5, 4, 4, 3, 3
   부대찌개: 5, 4, 3, 3, 3

   ❌ 제외된 메뉴 (0점 포함)

   짬뽕 (총점: 8점) - 0점을 준 사람: Alice, Eve
   ```

   → **김치찌개** 선택!

## 문제 해결

### Q: 메뉴 제안 후 목록이 업데이트되지 않아요
**A:** 네트워크 지연일 수 있습니다. 잠시 후 다시 확인해보세요. 계속 안 되면 봇을 재시작해주세요.

### Q: 투표 버튼이 작동하지 않아요
**A:** 투표가 이미 종료되었거나, 봇이 재시작되었을 수 있습니다. 새로운 투표를 시작해주세요.

### Q: 실수로 잘못 투표했어요
**A:** 투표 종료 전까지는 다시 "투표하기" 버튼을 눌러 수정할 수 있습니다.

### Q: 다른 사람이 제안한 메뉴를 취소하고 싶어요
**A:** 투표 생성자나 관리자에게 요청하세요. 일반 사용자는 본인이 제안한 메뉴만 취소할 수 있습니다.

### Q: 제한된 투표에 참여할 수 없어요
**A:** 투표 생성자에게 `/투표허용` 명령어로 추가해달라고 요청하세요.

### Q: 랜덤 선택 버튼이 안 보여요
**A:** 1위가 하나뿐이면 버튼이 표시되지 않습니다. 1위가 여러 개인 경우에만 표시됩니다.

### Q: 모든 메뉴가 0점을 받았어요
**A:** 결과 화면에 경고 메시지가 표시되며, 모든 메뉴가 "제외된 메뉴" 섹션에 표시됩니다. 다시 투표를 시작하는 것을 권장합니다.
